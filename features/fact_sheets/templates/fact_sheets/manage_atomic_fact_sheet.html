{% extends 'app_kit/manage_generic_content.html' %}
{% load i18n imagekit static app_tags %}

{% block extra_style %}
	<link href="{% static 'online_content/online_content.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
	<div class="container-fluid mt-3">
		<div class="row">
			<div class="col-12">
				<h3>
					{{ fact_sheet.title }} <img src="{% static 'localcosmos_server/images/countries/' %}{{ fact_sheet.fact_sheets.primary_language }}.gif" />
				</h3>

				{% if saved %}
					<div class="row">
						<div class="col-12">
							<div class="alert alert-success">
								{% trans 'Successfully saved your content.' %}
							</div>
						</div>
					</div>
				{% endif %}

			</div>
		</div>

		<div class="row">
			<div class="col-12 col-md-6">
			
				<div class="row">
					<div class="col-12">
					
						<div class="card">
							<div class="card-body">
								{% render_taxonomic_restriction fact_sheet %}
							</div>
						</div>
					</div>
				</div>
				
				<hr>
				
				<h4>{% trans 'Components' %}</h4>
				<form id="contentform" action="{% url 'manage_factsheet' meta_app.id fact_sheet.id %}" method="POST">{% csrf_token %}

					{% for field in form %}
						{% with cms_object=field.field.cms_tag %}

							{% if cms_object.multi %}
			
								{% if field.field.is_first %}
									{% if cms_object.is_file %}
										<div class="row field-label">
											<div class="col-12">
												{{ field.label }}
											</div>
										</div>
									{% endif %}
									<div id="{{ cms_object.microcontent_category }}-{{ cms_object.microcontent_type }}-container" class="row">
								{% endif %}

										{% if cms_object.is_file %}
											{% include 'fact_sheets/widgets/filecontent_field.html' %}
										{% else %}
											<div class="col-12" {% if not cms_object.localized_instance.pk %}data-new="1"{% endif %}>
												{% include 'online_content/textcontent_field.html' %}
											</div>
										{% endif %}

								{% if field.field.is_last %}
									</div>
									<div class="row">
										<div class="col-12 text-center"><br>
											<button type="button" class="btn btn-outline-secondary add-content-button" data-target="{{ cms_object.microcontent_category }}-{{ cms_object.microcontent_type }}-container">{% blocktrans with name=cms_object.microcontent_type %}add {{ name }}{% endblocktrans %}</button>
										</div>
									</div>
								{% endif %}
			
							{% else %}

			
								{% if cms_object.is_file %}
									{% if field.is_hidden %}
									{% else %}
										<div class="row field-label">
											<div class="col-12">
												{{ field.label }}
											</div>
										</div>
									{% endif %}
									<div id="{{ cms_object.microcontent_category }}-{{ cms_object.microcontent_type }}-container" class="row">
										{% include 'fact_sheets/widgets/filecontent_field.html' %}
									</div>
								{% else %}
									{% include 'online_content/textcontent_field.html' %}
								{% endif %}


							{% endif %}				

						{% endwith %}
					{% endfor %}

					<hr>
					<p>
						<button type="submit" class="btn btn-outline-primary">{% trans 'save fact sheet' %}</button>
					</p>
				</form>
			</div>
			<div class="col-12 col-md-6">
				<h4>{% trans 'Preview' %} <small><a href="{{ preview_url }}" target="_blank">{% trans 'Show in separate window' %}</a></small></h4>
				<object id="contentPreview" type="text/html" data="{{ preview_url }}"></object>
			</div>
		</div>
	</div>
{% endblock %}
{% block extra_script %}
	{% include 'online_content/manage_template_content_extra_scripts.html' %}

	<script>

		$(".add-content-button").on("click", function(ev){
			ev.preventDefault();
			var target =  $(this).attr("data-target");
			cms_add_element("#" + target);
		});


		function reloadPreview(){
			$("#contentPreview").attr("data", "{{ preview_url }}");
		}


		$(".fileupload input").on("change", function(event){
			{% include 'online_content/content_managing_js.html' %}
		});

	</script>
{% endblock %}
