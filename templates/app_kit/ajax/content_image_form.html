{% extends 'localcosmos_server/modals/large_modal_form.html' %}

{% load i18n localcosmos_tags app_tags %}

{% block above %}
	<form method="POST" action="{% url 'manage_content_image' meta_app.id content_type.id content_instance.id %}?{% if new %}new=1&{% endif %}{% if content_image_taxon %}taxon_source={{ content_image_taxon.taxon_source }}&taxon_latname={{ content_image_taxon.taxon_latname }}&taxon_author={{ content_image_taxon.taxon_author }}{% endif %}" enctype="multipart/form-data" class="xhr">{% csrf_token %}
{% endblock %}

{% block title %}
	{% trans 'Manage image' %}
{% endblock %}

{% block body %}
	<p>
		{% if request.method == 'POST' and form.is_valid %}
		{% else %}
			{% render_bootstrap_form form %}
		{% endif %}
	</p>
{% endblock %}

{% block footer %}
	<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">{% trans 'Cancel' %}</button>
	{% if content_image %}
		<a href="#" data-url="{% url 'delete_content_image' content_image.pk %}" ajax-target="ModalContent" class="btn btn-danger xhr">{% trans 'Delete' %}</a>
	{% endif %}
	<button type="submit" class="btn btn-outline-primary">{% trans 'Save' %}</button>
{% endblock %}

{% block script %}

	<script>
		
		

		{% if request.method == 'POST' and form.is_valid %}
			
			var d = new Date();
			$("#content_image_{{ content_instance|ctype_id }}_{{ content_instance.id }}").css("background-image", "url('{{ content_instance.image_url }}?" + d.getTime() + "')");

			$("#LargeModal").modal("hide");
			$("#LargeModalContent").empty();
		{% else %}
			{% include 'app_kit/snippets/ckeditor_js_snippet.html' %}
		{% endif %}
	</script>

	<style>
		.ck-editor__editable {
			min-height: 50px;
		}
	</style>
{% endblock %}
